# Leaf Disease AI - æœ¬åœ°ç«¯é–‹ç™¼ç’°å¢ƒ

è‘‰ç‰‡ç—…å®³æª¢æ¸¬ AI ç³»çµ±ï¼ˆæœ¬åœ°ç«¯å°ˆç”¨ç‰ˆæœ¬ï¼‰

## åŠŸèƒ½ç‰¹è‰²

-   ğŸ¤– AI ç—…å®³æª¢æ¸¬ï¼šä½¿ç”¨ YOLOv11 æ¨¡å‹é€²è¡Œè‘‰ç‰‡ç—…å®³æª¢æ¸¬
-   ğŸ“Š çµ±è¨ˆåˆ†æï¼šä½¿ç”¨è€…æª¢æ¸¬æ­·å²èˆ‡çµ±è¨ˆè³‡æ–™
-   ğŸ” ä½¿ç”¨è€…èªè­‰ï¼šè¨»å†Šã€ç™»å…¥ã€å€‹äººè³‡æ–™ç®¡ç†
-   âš¡ Redis å¿«å–ï¼šæå‡ API éŸ¿æ‡‰é€Ÿåº¦
-   ğŸ“š Swagger API æ–‡æª”ï¼šå®Œæ•´çš„ API æ–‡æª”èˆ‡æ¸¬è©¦ä»‹é¢
-   â˜ï¸ Cloudinary åœ–ç‰‡å„²å­˜ï¼šå¯é¸çš„é›²ç«¯åœ–ç‰‡å„²å­˜æœå‹™ï¼ˆæ”¯æ´è‡ªå‹•å„ªåŒ–ï¼‰

## ç³»çµ±éœ€æ±‚

-   Python 3.8+
-   PostgreSQL 12+
-   Redis 6.0+ï¼ˆå¯é¸ï¼Œæœªå®‰è£æ™‚æœƒè‡ªå‹•é™ç´šï¼‰
-   Node.js 16+ï¼ˆå‰ç«¯é–‹ç™¼ï¼‰

## å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

**å¾Œç«¯ä¾è³´ï¼š**

```bash
pip install -r requirements.txt
```

**å‰ç«¯ä¾è³´ï¼š**

```bash
cd frontend
npm install
```

### 2. è¨­å®šç’°å¢ƒè®Šæ•¸

å‰µå»º `.env` æª”æ¡ˆï¼ˆåœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰ï¼š

```bash
# è³‡æ–™åº«è¨­å®š
DB_HOST=localhost
DB_PORT=5432
DB_NAME=leaf_disease_ai
DB_USER=postgres
DB_PASSWORD=your_password

# Redis è¨­å®šï¼ˆå¯é¸ï¼‰
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# Cloudinary åœ–ç‰‡å„²å­˜è¨­å®šï¼ˆå¼·çƒˆå»ºè­°å•Ÿç”¨ï¼‰
# åœ–ç‰‡ç¾åœ¨å®Œå…¨å„²å­˜åœ¨ Cloudinaryï¼Œä¸å†å„²å­˜åœ¨è³‡æ–™åº« BLOB
USE_CLOUDINARY=true
CLOUDINARY_CLOUD_NAME=dcqts6ryi
CLOUDINARY_API_KEY=398648383382972
CLOUDINARY_API_SECRET=your_api_secret_here  # è«‹æ›¿æ›ç‚ºæ‚¨çš„ API Secret
CLOUDINARY_SECURE=true
CLOUDINARY_FOLDER=leaf_disease_ai

# æ‡‰ç”¨è¨­å®š
SECRET_KEY=your-secret-key-here
```

### 3. åˆå§‹åŒ–è³‡æ–™åº«

**æ–¹å¼ä¸€ï¼šä½¿ç”¨è³‡æ–™åº«ç®¡ç†è…³æœ¬ï¼ˆæ¨è–¦ï¼‰**

åˆå§‹åŒ–è³‡æ–™åº«ï¼ˆå¦‚æœä¸å­˜åœ¨å‰‡å‰µå»ºï¼‰ï¼š

åˆå§‹åŒ–è³‡æ–™åº«ï¼ˆå¦‚æœä¸å­˜åœ¨å‰‡å‰µå»ºï¼‰ï¼š

```bash
python database/database_manager.py init
```

æˆ–ç›´æ¥åŸ·è¡Œï¼ˆé è¨­ç‚º init æ¨¡å¼ï¼‰ï¼š

```bash
python database/database_manager.py
```

è…³æœ¬æœƒè‡ªå‹•åŸ·è¡Œï¼š

1. å‰µå»ºè³‡æ–™åº«ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
2. åŸ·è¡Œå®Œæ•´è³‡æ–™åº«åˆå§‹åŒ–ï¼ˆ`database/init_database.sql`ï¼‰
    - åŒ…å«ï¼šè¡¨çµæ§‹ã€è¦–åœ–ã€å‡½æ•¸ã€è§¸ç™¼å™¨ã€åœ–ç‰‡å­˜å„²åŠŸèƒ½ã€prediction_log è¡¨ã€ç—…å®³è³‡è¨Šè³‡æ–™

**æ–¹å¼äºŒï¼šé‡ç½®è³‡æ–™åº«ï¼ˆåˆªé™¤ä¸¦é‡æ–°å‰µå»ºï¼‰**

```bash
python database/database_manager.py reset
```

âš ï¸ **è­¦å‘Š**ï¼šæ­¤æ“ä½œå°‡åˆªé™¤æ‰€æœ‰ç¾æœ‰è³‡æ–™ï¼
è…³æœ¬æœƒè‡ªå‹•åŸ·è¡Œï¼š

1. åˆªé™¤ç¾æœ‰è³‡æ–™åº«
2. å‰µå»ºæ–°è³‡æ–™åº«
3. åŸ·è¡Œå®Œæ•´è³‡æ–™åº«åˆå§‹åŒ–ï¼ˆ`database/init_database.sql`ï¼‰
    - åŒ…å«ï¼šè¡¨çµæ§‹ã€è¦–åœ–ã€å‡½æ•¸ã€è§¸ç™¼å™¨ã€åœ–ç‰‡å­˜å„²åŠŸèƒ½ã€prediction_log è¡¨ã€ç—…å®³è³‡è¨Šè³‡æ–™

**æ–¹å¼ä¸‰ï¼šæ‰‹å‹•åŸ·è¡Œ SQL**

```bash
# å…ˆå‰µå»ºè³‡æ–™åº«
createdb -U postgres -p 5433 leaf_disease_ai

# åŸ·è¡Œå®Œæ•´è³‡æ–™åº«åˆå§‹åŒ–ï¼ˆåŒ…å«æ‰€æœ‰å…§å®¹ï¼‰
psql -U postgres -d leaf_disease_ai -p 5433 -f database/init_database.sql
```

**æ³¨æ„**ï¼šå¦‚æœä½¿ç”¨éé è¨­ç«¯å£ï¼ˆå¦‚ 5433ï¼‰ï¼Œè«‹åœ¨ `.env` ä¸­è¨­å®š `DB_PORT=5433`

### 4. å•Ÿå‹• Redisï¼ˆå¯é¸ä½†å»ºè­°ï¼‰

**macOS:**

```bash
brew install redis
brew services start redis
```

**Linux:**

```bash
sudo apt-get install redis-server
sudo systemctl start redis
```

**Windows:**
ä¸‹è¼‰ä¸¦å®‰è£ Redis for Windowsï¼Œæˆ–ä½¿ç”¨ Dockerï¼š

```bash
docker run -d -p 6379:6379 redis:latest
```

### 5. å•Ÿå‹•æœå‹™

**æ–¹å¼ä¸€ï¼šä½¿ç”¨å•Ÿå‹•è…³æœ¬**

```bash
chmod +x scripts/start.sh
./scripts/start.sh
```

**æ–¹å¼äºŒï¼šæ‰‹å‹•å•Ÿå‹•**

å¾Œç«¯ï¼š

```bash
cd backend
python app.py
```

å‰ç«¯ï¼š

```bash
cd frontend
npm run dev
```

## API æ–‡æª”

å•Ÿå‹•å¾Œç«¯æœå‹™å¾Œï¼Œè¨ªå• Swagger API æ–‡æª”ï¼š

-   **Swagger UI**: http://localhost:5000/api-docs
-   **API Spec JSON**: http://localhost:5000/apispec.json

## ç›®éŒ„çµæ§‹

```
Leaf_Disease_AI_local/
â”œâ”€â”€ backend/                    # Flask å¾Œç«¯
â”‚   â”œâ”€â”€ app.py                  # ä¸»æ‡‰ç”¨ç¨‹å¼ï¼ˆè·¯ç”±å®šç¾©ï¼‰
â”‚   â”œâ”€â”€ modules/                # AI æ¨¡å‹æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ cnn_*.py            # CNN ç›¸é—œæ¨¡çµ„
â”‚   â”‚   â””â”€â”€ yolo_*.py           # YOLO ç›¸é—œæ¨¡çµ„
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡çµ„
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ core_app_config.py    # æ‡‰ç”¨ç¨‹å¼é…ç½®å’Œåˆå§‹åŒ–
â”‚       â”‚   â”œâ”€â”€ core_db_manager.py    # è³‡æ–™åº«ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ core_helpers.py       # æ ¸å¿ƒè¼”åŠ©å‡½æ•¸ï¼ˆèªè­‰ã€æ—¥èªŒï¼‰
â”‚       â”‚   â”œâ”€â”€ core_redis_manager.py # Redis å¿«å–ç®¡ç†
â”‚       â”‚   â””â”€â”€ core_user_manager.py  # ä½¿ç”¨è€…ç®¡ç†
â”‚       â””â”€â”€ services/           # æ¥­å‹™æœå‹™
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ service_auth.py              # èªè­‰æœå‹™
â”‚           â”œâ”€â”€ service_cnn.py                # CNN åˆ†é¡æœå‹™
â”‚           â”œâ”€â”€ service_cloudinary.py         # Cloudinary å„²å­˜æœå‹™
â”‚           â”œâ”€â”€ service_image.py              # åœ–ç‰‡è™•ç†æœå‹™
â”‚           â”œâ”€â”€ service_image_manager.py      # åœ–ç‰‡ç®¡ç†å™¨
â”‚           â”œâ”€â”€ service_integrated.py         # æ•´åˆæª¢æ¸¬æœå‹™
â”‚           â”œâ”€â”€ service_integrated_api.py     # æ•´åˆæª¢æ¸¬ API æœå‹™
â”‚           â”œâ”€â”€ service_user.py               # ä½¿ç”¨è€…æœå‹™
â”‚           â”œâ”€â”€ service_yolo.py               # YOLO æª¢æ¸¬æœå‹™
â”‚           â””â”€â”€ service_yolo_api.py           # YOLO æª¢æ¸¬ API æœå‹™
â”œâ”€â”€ config/                     # é…ç½®æª”æ¡ˆ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                 # åŸºç¤é…ç½®
â”‚   â”œâ”€â”€ development.py           # é–‹ç™¼ç’°å¢ƒé…ç½®
â”‚   â””â”€â”€ production.py           # ç”Ÿç”¢ç’°å¢ƒé…ç½®
â”œâ”€â”€ database/                   # è³‡æ–™åº«è…³æœ¬å’Œå·¥å…·
â”‚   â”œâ”€â”€ init_database.sql       # å®Œæ•´è³‡æ–™åº«åˆå§‹åŒ–
â”‚   â”œâ”€â”€ database_manager.py     # è³‡æ–™åº«ç®¡ç†è…³æœ¬ï¼ˆinit/resetï¼‰
â”‚   â”œâ”€â”€ README.md               # è³‡æ–™åº«èªªæ˜
â”‚   â””â”€â”€ SQL_REFERENCE.md        # SQL èªå¥åƒè€ƒæ–‡æª”
â”œâ”€â”€ docs/                       # æ–‡æª”
â”‚   â”œâ”€â”€ complete_documentation.md # å®Œæ•´ç³»çµ±æ–‡æª”
â”‚   â””â”€â”€ sequences_diagram.md    # ç³»çµ±åºåˆ—åœ–
â”œâ”€â”€ frontend/                   # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api.js              # API èª¿ç”¨å°è£
â”‚   â”‚   â”œâ”€â”€ App.jsx             # ä¸»æ‡‰ç”¨çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ main.jsx            # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ styles.css          # æ¨£å¼æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ components/         # React çµ„ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.mts         # Vite é…ç½®
â”œâ”€â”€ model/                      # AI æ¨¡å‹
â”‚   â”œâ”€â”€ CNN/                    # CNN æ¨¡å‹
â”‚   â”‚   â””â”€â”€ CNN_v1.0_20251204/
â”‚   â””â”€â”€ yolov11/                # YOLO æ¨¡å‹
â”‚       â””â”€â”€ best_v1_50.pt
â”œâ”€â”€ scripts/                    # è…³æœ¬æ–‡ä»¶
â”‚   â””â”€â”€ start.sh                # å•Ÿå‹•è…³æœ¬
â”œâ”€â”€ tests/                      # æ¸¬è©¦æ–‡ä»¶ï¼ˆé ç•™ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ uploads/                    # ä¸Šå‚³åœ–ç‰‡æš«å­˜ï¼ˆè‡ªå‹•å‰µå»ºï¼‰
â”œâ”€â”€ .env.example                # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ requirements.txt            # Python ä¾è³´
â””â”€â”€ README.md                   # å°ˆæ¡ˆèªªæ˜æ–‡æª”
```

## ä¸»è¦åŠŸèƒ½èªªæ˜

### Redis å¿«å–

ç³»çµ±ä½¿ç”¨ Redis é€²è¡Œä»¥ä¸‹å¿«å–ï¼š

-   **ä½¿ç”¨è€…çµ±è¨ˆè³‡æ–™**ï¼šå¿«å– 5 åˆ†é˜
-   **æª¢æ¸¬çµæœ**ï¼šå¿«å– 1 å°æ™‚ï¼ˆåŸºæ–¼åœ–ç‰‡ hashï¼‰
-   **ç™»å…¥å˜—è©¦é™åˆ¶**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£

å¦‚æœ Redis æœªå®‰è£æˆ–ç„¡æ³•é€£æ¥ï¼Œç³»çµ±æœƒè‡ªå‹•é™ç´šï¼Œä¸å½±éŸ¿åŸºæœ¬åŠŸèƒ½ã€‚

### Swagger API æ–‡æª”

æ‰€æœ‰ API ç«¯é»éƒ½æœ‰å®Œæ•´çš„ Swagger æ–‡æª”ï¼ŒåŒ…æ‹¬ï¼š

-   è«‹æ±‚åƒæ•¸èªªæ˜
-   å›æ‡‰æ ¼å¼ç¯„ä¾‹
-   éŒ¯èª¤ç¢¼èªªæ˜
-   ç·šä¸Šæ¸¬è©¦åŠŸèƒ½

### API ç«¯é»

#### èªè­‰ç›¸é—œ

-   `POST /register` - ä½¿ç”¨è€…è¨»å†Š
-   `POST /login` - ä½¿ç”¨è€…ç™»å…¥
-   `GET/POST /logout` - ä½¿ç”¨è€…ç™»å‡º
-   `GET /check-auth` - æª¢æŸ¥ç™»å…¥ç‹€æ…‹

#### ä½¿ç”¨è€…ç›¸é—œ

-   `GET /user/profile` - ç²å–å€‹äººè³‡æ–™
-   `POST /user/change-password` - ä¿®æ”¹å¯†ç¢¼
-   `GET /user/stats` - ç²å–çµ±è¨ˆè³‡æ–™ï¼ˆå¿«å–ï¼‰

#### æª¢æ¸¬ç›¸é—œ

-   `POST /api/predict` - æ•´åˆæª¢æ¸¬ï¼ˆCNN + YOLOï¼Œå¿«å–ï¼‰
-   `POST /api/predict-crop` - è£åˆ‡å¾Œé‡æ–°æª¢æ¸¬
-   `POST /predict` - èˆŠç‰ˆæª¢æ¸¬ç«¯é»ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
-   `GET /history` - ç²å–æª¢æ¸¬æ­·å²

## é–‹ç™¼èªªæ˜

-   **å¾Œç«¯é…ç½®**ï¼šä½¿ç”¨ `config.development.DevelopmentConfig`
-   **è³‡æ–™åº«**ï¼šPostgreSQLï¼Œé€£æ¥è³‡è¨Šåœ¨ `.env` ä¸­è¨­å®š
-   **å¿«å–**ï¼šRedisï¼ˆå¯é¸ï¼‰ï¼Œé…ç½®åœ¨ `.env` ä¸­è¨­å®š
-   **å‰ç«¯**ï¼šVite dev serverï¼Œè‡ªå‹• proxy åˆ°å¾Œç«¯

## æ³¨æ„äº‹é …

1. æ­¤å°ˆæ¡ˆåƒ…ç”¨æ–¼æœ¬åœ°ç«¯é–‹ç™¼ï¼Œä¸é©åˆç›´æ¥éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
2. ç¢ºä¿ PostgreSQL å’Œ Redis æœå‹™å·²å•Ÿå‹•
3. æ¨¡å‹æª”æ¡ˆ `model/yolov11/best_v1_50.pt` éœ€è¦å­˜åœ¨
4. åœ–ç‰‡å„²å­˜ï¼š
    - **Cloudinaryï¼ˆæ¨è–¦ï¼‰**ï¼šåœ–ç‰‡ç¾åœ¨å®Œå…¨å„²å­˜åœ¨ Cloudinary é›²ç«¯ï¼Œä¸å†å„²å­˜åœ¨è³‡æ–™åº« BLOB
    - é è¨­å•Ÿç”¨ Cloudinaryï¼Œéœ€è¦åœ¨ `.env` ä¸­è¨­å®š `CLOUDINARY_API_SECRET`
    - å¦‚æœæœªè¨­å®š Cloudinaryï¼Œç³»çµ±æœƒä½¿ç”¨æœ¬åœ°æ–‡ä»¶å„²å­˜ï¼ˆ`uploads/` ç›®éŒ„ï¼‰
    - è³‡æ–™åº«å„ªåŒ–å·²åŒ…å«åœ¨ `init_database.sql` ä¸­ï¼Œç„¡éœ€å–®ç¨åŸ·è¡Œ

## æ•…éšœæ’é™¤

### è³‡æ–™åº«ä¸å­˜åœ¨éŒ¯èª¤

å¦‚æœçœ‹åˆ° "database 'leaf_disease_ai' does not exist" éŒ¯èª¤ï¼š

1. **ä½¿ç”¨è³‡æ–™åº«ç®¡ç†è…³æœ¬ï¼ˆæ¨è–¦ï¼‰**ï¼š

    ```bash
    python database/database_manager.py init
    ```

    æˆ–ç›´æ¥åŸ·è¡Œï¼š

    ```bash
    python database/database_manager.py
    ```

2. **æˆ–æ‰‹å‹•å‰µå»ºè³‡æ–™åº«**ï¼š

    ```bash
    # å‰µå»ºè³‡æ–™åº«
    createdb -U postgres -p 5433 leaf_disease_ai

    # åŸ·è¡Œå®Œæ•´è³‡æ–™åº«åˆå§‹åŒ–ï¼ˆåŒ…å«æ‰€æœ‰å…§å®¹ï¼‰
    psql -U postgres -d leaf_disease_ai -p 5433 -f database/init_database.sql
    ```

### è³‡æ–™åº«é€£æ¥å¤±æ•—

-   æª¢æŸ¥ PostgreSQL æœå‹™æ˜¯å¦é‹è¡Œï¼š`pg_isready -p 5433`
-   ç¢ºèª `.env` ä¸­çš„è³‡æ–™åº«è¨­å®šæ­£ç¢ºï¼ˆç‰¹åˆ¥æ˜¯ `DB_PORT`ï¼‰
-   ç¢ºèªè³‡æ–™åº«ä½¿ç”¨è€…æœ‰å‰µå»ºè³‡æ–™åº«çš„æ¬Šé™

### Redis é€£æ¥å¤±æ•—

å¦‚æœçœ‹åˆ° "âš ï¸ Redis é€£æ¥å¤±æ•—" çš„è­¦å‘Šï¼Œç³»çµ±ä»å¯æ­£å¸¸é‹è¡Œï¼Œåªæ˜¯ä¸æœƒä½¿ç”¨å¿«å–åŠŸèƒ½ã€‚ç¢ºä¿ Redis æœå‹™å·²å•Ÿå‹•ï¼š

```bash
redis-cli ping  # æ‡‰è©²è¿”å› PONG
```

### æ¨¡å‹è¼‰å…¥å¤±æ•—

ç¢ºä¿æ¨¡å‹æª”æ¡ˆè·¯å¾‘æ­£ç¢ºï¼š`model/yolov11/best_v1_50.pt`

## ç‰ˆæœ¬è³‡è¨Š

-   **ç‰ˆæœ¬**: 2.0.0
-   **æ¨¡å¼**: æœ¬åœ°ç«¯é–‹ç™¼
-   **æœ€å¾Œæ›´æ–°**: 2024
